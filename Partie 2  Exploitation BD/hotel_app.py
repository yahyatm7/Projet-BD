import streamlit as st
import sqlite3
from datetime import datetime

# Connexion à la base de données
conn = sqlite3.connect('hotel.db')
cursor = conn.cursor()

# Titre de l'application
st.title("Gestion de l'Hôtel")

# 1. Consulter la liste des réservations
st.header("Liste des Réservations")
reservations = cursor.execute("SELECT r.Id_Réservation, c.Nom_complet, r.Date_arrivée, r.Date_de_part FROM Réservation r JOIN Client c ON r.Id_Client = c.Id_Client").fetchall()
st.table(reservations)

# 2. Consulter la liste des clients
st.header("Liste des Clients")
clients = cursor.execute("SELECT Id_Client, Nom_complet, Adresse, Ville FROM Client").fetchall()
st.table(clients)

# 3. Consulter les chambres disponibles pour une période donnée
st.header("Chambres Disponibles")
start_date = st.date_input("Date d'arrivée", datetime(2025, 6, 1))
end_date = st.date_input("Date de départ", datetime(2025, 6, 5))
available_rooms = cursor.execute("""
    SELECT ch.Id_Chambre, ch.Numéro, ch.Étage, tc.Type
    FROM Chambre ch
    JOIN Type_Chambre tc ON ch.Id_Type = tc.Id_Type
    LEFT JOIN Réservation r ON ch.Id_Chambre = r.Id_Réservation
    WHERE r.Id_Réservation IS NULL
    OR (r.Date_arrivée > ? OR r.Date_de_part < ?)
""", (end_date, start_date)).fetchall()
st.table(available_rooms)

# 4. Ajouter un client
st.header("Ajouter un Client")
with st.form(key='client_form'):
    client_name = st.text_input("Nom complet")
    address = st.text_input("Adresse")
    city = st.text_input("Ville")
    postal_code = st.number_input("Code postal", min_value=0)
    email = st.text_input("E-mail")
    phone = st.text_input("Numéro de téléphone")
    submit_client = st.form_submit_button(label='Ajouter Client')
    if submit_client:
        cursor.execute("""
            INSERT INTO Client (Nom_complet, Adresse, Ville, Code_postal, E_mail, Numéro_de_téléphone)
            VALUES (?, ?, ?, ?, ?, ?)
        """, (client_name, address, city, postal_code, email, phone))
        conn.commit()
        st.success("Client ajouté avec succès!")

# 5. Ajouter une réservation
st.header("Ajouter une Réservation")
with st.form(key='reservation_form'):
    client_id = st.number_input("ID du Client", min_value=1)
    start_date_res = st.date_input("Date d'arrivée", datetime(2025, 6, 1))
    end_date_res = st.date_input("Date de départ", datetime(2025, 6, 5))
    submit_res = st.form_submit_button(label='Ajouter Réservation')
    if submit_res:
        cursor.execute("""
            INSERT INTO Réservation (Id_Client, Date_arrivée, Date_de_part)
            VALUES (?, ?, ?)
        """, (client_id, start_date_res, end_date_res))
        conn.commit()
        st.success("Réservation ajoutée avec succès!")

# Fermeture de la connexion
conn.close() 
